CREATE OR ALTER VIEW [ODSMasterDataEnrichment_manual] AS
SELECT
-- First row is handled differently to make sure the columns are named correctly
	'571313180000000005' AS 'MarketEvaluationPoint_mRID',
	CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127) AS 'ValidFrom', --127 is ISO8601 with ending Z, meaning yyyy-MM-ddThh:mm:ss.fffZ (no spaces)
	CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127) AS 'ValidTo',
	'PT1H' AS 'MeterReadingPeriodicity',
	'D01' AS 'MeteringMethod',
	'800' AS 'MeteringGridArea_Domain_mRID',
	'D03' AS 'ConnectionState',
	NULL AS 'EnergySupplier_MarketParticipant_mRID',
	NULL AS 'BalanceResponsibleParty_MarketParticipant_mRID',
	NULL AS 'InMeteringGridArea_Domain_mRID',
	NULL AS 'OutMeteringGridArea_Domain_mRID',
	NULL AS 'Parent_Domain_mRID',
	CONVERT(bit, 0) AS 'ServiceCategory_Kind',
	'E17' AS 'MarketEvaluationPointType',
	'D01' AS 'SettlementMethod',
	'KWH' AS 'QuantityMeasurementUnit_Name',
	'8716867000030' AS 'Product',
	NULL AS 'Technology',
	NULL AS 'OutMeteringGridArea_Domain_Owner_mRID',
	NULL 'InMeteringGridArea_Domain_Owner_mRID',
	'Flex MP connection state new' AS 'Meta'
-- now the remaining lines
UNION SELECT '571313180000000005',CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-11-14T23:00:00.000Z', 127),'PT1H','D01','800','E22','8100000000108','8100000000207',NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP, connection state connected, supplier A'
UNION SELECT '571313180000000005',CONVERT(DATETIME, '2020-11-14T23:00:00.000Z', 127),NULL,'PT1H','D01','800','E22','8100000000115','8100000000214',NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP, connection state connected, supplier B'
UNION SELECT '571313180000000012',CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),'PT1H','D01','800','D03',NULL,NULL,NULL,NULL,NULL,CONVERT(bit, 0),'E17','E02','KWH','8716867000030',NULL,NULL,NULL,'Non-profiled MP, connection state new'
UNION SELECT '571313180000000012',CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-11-14T23:00:00.000Z', 127),'PT1H','D01','800','E22','8100000000108','8100000000207',NULL,NULL,NULL,CONVERT(bit, 0),'E17','E02','KWH','8716867000030',NULL,NULL,NULL,'Non-profiled MP, connection state connected, supplier A'
UNION SELECT '571313180000000012',CONVERT(DATETIME, '2020-11-14T23:00:00.000Z', 127),NULL,'PT1H','D01','800','E22','8100000000115','8100000000214',NULL,NULL,NULL,CONVERT(bit, 0),'E17','E02','KWH','8716867000030',NULL,NULL,NULL,'Non-profiled MP, connection state connected, supplier B'
UNION SELECT '571313180000000029',CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),'PT1H','D01','800','D03',NULL,NULL,NULL,NULL,NULL,CONVERT(bit, 0),'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,'Production MP, hourly, connection state new'
UNION SELECT '571313180000000029',CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-11-14T23:00:00.000Z', 127),'PT1H','D01','800','E22','8100000000108','8100000000207',NULL,NULL,NULL,CONVERT(bit, 0),'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,'Production MP, hourly, connection state connected, supplier A'
UNION SELECT '571313180000000029',CONVERT(DATETIME, '2020-11-14T23:00:00.000Z', 127),NULL,'PT1H','D01','800','E22','8100000000115','8100000000214',NULL,NULL,NULL,CONVERT(bit, 0),'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,'Production MP, hourly, connection state connected, supplier B'
UNION SELECT '571313180000000036',CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),'PT15M','D01','800','D03',NULL,NULL,NULL,NULL,NULL,CONVERT(bit, 0),'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,'Production MP, 15min, connection state new'
UNION SELECT '571313180000000036',CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-11-14T23:00:00.000Z', 127),'PT15M','D01','800','E22','8100000000108','8100000000207',NULL,NULL,NULL,CONVERT(bit, 0),'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,'Production MP, 15min, connection state connected, supplier A'
UNION SELECT '571313180000000036',CONVERT(DATETIME, '2020-11-14T23:00:00.000Z', 127),NULL,'PT15M','D01','800','E22','8100000000115','8100000000214',NULL,NULL,NULL,CONVERT(bit, 0),'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,'Production MP, 15min, connection state connected, supplier B'
UNION SELECT '571313180000000043',CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-11-30T23:00:00.000Z', 127),'PT1H','D02','800','D03',NULL,NULL,NULL,NULL,NULL,CONVERT(bit, 0),'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,'Production MP, hourly, connection state new'
UNION SELECT '571313180000000043',CONVERT(DATETIME, '2020-11-30T23:00:00.000Z', 127),NULL,'PT1H','D01','800','D02',NULL,NULL,NULL,NULL,NULL,CONVERT(bit, 0),'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,'Production MP, hourly, connection state closed down'
UNION SELECT '571313180000000050',CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-01-01T23:00:00.000Z', 127),'PT1H','D01','800','D03',NULL,NULL,'800','801',NULL,CONVERT(bit, 0),'E20',NULL,'KWH','8716867000030',NULL,'8100000000009','8100000000016','Exchange MP, hourly, connection state new, out-grid not owned'
UNION SELECT '571313180000000050',CONVERT(DATETIME, '2020-01-01T23:00:00.000Z', 127),NULL,'PT1H','D01','800','E22',NULL,NULL,'800','801',NULL,CONVERT(bit, 0),'E20',NULL,'KWH','8716867000030',NULL,'8100000000009','8100000000016','Exchange MP, hourly, connection state connected, out-grid not owned'
UNION SELECT '571313180000000067',CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-01-01T23:00:00.000Z', 127),'PT15M','D01','800','D03',NULL,NULL,'801','800',NULL,CONVERT(bit, 0),'E20',NULL,'KWH','8716867000030',NULL,'8100000000016','8100000000009','Exchange MP, 15min, connection state new, in-grid not owned'
UNION SELECT '571313180000000067',CONVERT(DATETIME, '2020-01-01T23:00:00.000Z', 127),NULL,'PT15M','D01','800','E22',NULL,NULL,'801','800',NULL,CONVERT(bit, 0),'E20',NULL,'KWH','8716867000030',NULL,'8100000000016','8100000000009','Exchange MP, 15min, connection state connected, in-grid not owned'
UNION SELECT '571313180000000074',CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-01-01T23:00:00.000Z', 127),'PT15M','D01','800','D03',NULL,NULL,'802','803',NULL,CONVERT(bit, 0),'E20',NULL,'KWH','8716867000030',NULL,'8100000000023','8100000000030','Exchange MP, parent, 15min, connection state new, both in- and out-grid not owned'
UNION SELECT '571313180000000074',CONVERT(DATETIME, '2020-01-01T23:00:00.000Z', 127),NULL,'PT15M','D01','800','E22',NULL,NULL,'802','803',NULL,CONVERT(bit, 0),'E20',NULL,'KWH','8716867000030',NULL,'8100000000023','8100000000030','Exchange MP, parent, 15min, connection state connected, both in- and out-grid not owned'
UNION SELECT '571313180000000081',CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127),CONVERT(DATETIME, '2021-01-01T23:00:00.000Z', 127),'PT15M','D01','800','D03',NULL,NULL,'802','803','571313180000000074',CONVERT(bit, 0),'D20',NULL,'K3','8716867000047',NULL,'8100000000023','8100000000030','Exchange-Reactive energy MP, child 15min, connection state new, both in- and out-grid not owned'
UNION SELECT '571313180000000081',CONVERT(DATETIME, '2021-01-01T23:00:00.000Z', 127),NULL,'PT15M','D01','800','E22',NULL,NULL,'802','803','571313180000000074',CONVERT(bit, 0),'D20',NULL,'K3','8716867000047',NULL,'8100000000023','8100000000030','Exchange-Reactive energy MP, child, 15min, connection state connected, both in- and out-grid not owned'
UNION SELECT '571313180000000098',CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),'PT1H','D01','800','D03',NULL,NULL,NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP connection state new'
UNION SELECT '571313180000000098',CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),NULL,'PT1H','D01','800','E22','8100000000108','8100000000207',NULL,NULL,NULL,CONVERT(bit, 1),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP, parent, electricalHeating, connection state connected, supplier A'
UNION SELECT '571313180000000104',CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),NULL,'PT1H','D03','800','E22',NULL,NULL,NULL,NULL,'571313180000000098',CONVERT(bit, 1),'D14',NULL,'KWH','8716867000030',NULL,NULL,NULL,'Electrical Heating MP, child, connection state connected'
UNION SELECT '571313180000000111',CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),'PT1H','D01','800','D03',NULL,NULL,NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP connection state new'
UNION SELECT '571313180000000111',CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-11-14T23:00:00.000Z', 127),'PT1H','D01','800','E22','8100000000108','8100000000207',NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP connection state connected, suppler A'
UNION SELECT '571313180000000111',CONVERT(DATETIME, '2020-11-14T23:00:00.000Z', 127),NULL,'PT1H','D01','800','D02',NULL,NULL,NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP, connection state closed down'
UNION SELECT '571313180000000128',CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-01-01T23:00:00.000Z', 127),'PT1H','D01','800','D03',NULL,NULL,NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP connection state new'
UNION SELECT '571313180000000128',CONVERT(DATETIME, '2020-01-01T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),'PT1H','D01','800','E22','8100000000108','8100000000207',NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP, connection state connected, supplier A'
UNION SELECT '571313180000000128',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','800','E23','8100000000108','8100000000207',NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP connection state disconnected, supplier A'
UNION SELECT '571313180000000135',CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-03-28T23:00:00.000Z', 127),'PT1H','D01','800','D03',NULL,NULL,NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP connection state new'
UNION SELECT '571313180000000135',CONVERT(DATETIME, '2020-03-28T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-03-29T22:00:00.000Z', 127),'PT1H','D01','800','E22','8100000000108','8100000000207',NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP connection state connected, suppler A, daily saving switch'
UNION SELECT '571313180000000135',CONVERT(DATETIME, '2020-03-29T22:00:00.000Z', 127),CONVERT(DATETIME, '2020-10-24T22:00:00.000Z', 127),'PT1H','D01','800','E22','8100000000115','8100000000214',NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP connection state connected, suppler B'
UNION SELECT '571313180000000135',CONVERT(DATETIME, '2020-10-24T22:00:00.000Z', 127),CONVERT(DATETIME, '2020-12-31T23:00:00.000Z', 127),'PT1H','D01','800','E22','8100000000108','8100000000207',NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP connection state connected, suppler A daily saving switch'
UNION SELECT '571313180000000142',CONVERT(DATETIME, '2020-12-31T23:00:00.000Z', 127),NULL,'PT1H','D01','800','D02',NULL,NULL,NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP, connection state closed down'
UNION SELECT '571313180000000142',CONVERT(DATETIME, '2020-03-28T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-03-29T22:00:00.000Z', 127),'PT1H','D01','800','E22','8100000000108','8100000000207',NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP connection state connected, suppler A, daily saving switch'
UNION SELECT '571313180000000142',CONVERT(DATETIME, '2020-03-29T22:00:00.000Z', 127),CONVERT(DATETIME, '2020-10-24T22:00:00.000Z', 127),'PT1H','D01','800','E22','8100000000115','8100000000214',NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP connection state connected, suppler B'
UNION SELECT '571313180000000142',CONVERT(DATETIME, '2020-10-24T22:00:00.000Z', 127),CONVERT(DATETIME, '2020-12-31T23:00:00.000Z', 127),'PT1H','D01','800','E22','8100000000108','8100000000207',NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP connection state connected, suppler A daily saving switch'
UNION SELECT '571313180000000142',CONVERT(DATETIME, '2020-12-31T23:00:00.000Z', 127),NULL,'PT1H','D01','800','D02',NULL,NULL,NULL,NULL,NULL,CONVERT(bit, 0),'E17','D01','KWH','8716867000030',NULL,NULL,NULL,'Flex MP, connection state closed down'
UNION SELECT '571313180000000159',CONVERT(DATETIME, '2019-12-31T23:00:00.000Z', 127),CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),'PT1H','D02','800','D03',NULL,NULL,NULL,NULL,NULL,CONVERT(bit, 0),'D02',NULL,'KWH','8716867000030',NULL,NULL,NULL,'D02 Analysis MP, Not yet Child, connection state new'
UNION SELECT '571313180000000159',CONVERT(DATETIME, '2020-01-10T23:00:00.000Z', 127),NULL,'PT1H','D02','800','E22',NULL,NULL,NULL,NULL,'571313180000000098',CONVERT(bit, 0),'D02',NULL,'KWH','8716867000030',NULL,NULL,NULL,'D02 Analysis MP, CHILD, connection state Connected, Supplier A'
UNION SELECT '578710000000000004',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000006','8520000000005',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000011',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000013','8520000000012',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000028',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000020','8520000000005',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000035',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000006','8520000000005',NULL,NULL,NULL,NULL,'E17','E02','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000042',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000013','8520000000012',NULL,NULL,NULL,NULL,'E17','E02','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000059',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000020','8520000000005',NULL,NULL,NULL,NULL,'E17','E02','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000066',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000006','8520000000012',NULL,NULL,NULL,NULL,'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,NULL
UNION SELECT '578710000000000073',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000013','8520000000005',NULL,NULL,NULL,NULL,'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,NULL
UNION SELECT '578710000000000080',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000013','8520000000005',NULL,NULL,NULL,NULL,'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,NULL
UNION SELECT '578710000000000097',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT15M','D01','500','E22','8510000000020','8520000000029',NULL,NULL,NULL,NULL,'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,NULL
UNION SELECT '578710000000000103',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22',NULL,NULL,'501','500',NULL,NULL,'E20',NULL,'KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000110',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT15M','D01','500','E22',NULL,NULL,'502','500',NULL,NULL,'E20',NULL,'KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000127',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT15M','D01','500','E22',NULL,NULL,'500','501',NULL,NULL,'E20',NULL,'KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000219',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT15M','D01','500','E22',NULL,NULL,'502','501',NULL,NULL,'E20',NULL,'KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000226',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22',NULL,NULL,'500','500',NULL,NULL,'E20',NULL,'KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578720000000000001',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','501','E22','8510000000006','8520000000005',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578720000000000018',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','501','E22','8510000000013','8520000000012',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578720000000000025',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','501','E22','8510000000020','8520000000005',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578720000000000032',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','501','E22','8510000000006','8520000000005',NULL,NULL,NULL,NULL,'E17','E02','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578720000000000049',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','501','E22','8510000000013','8520000000012',NULL,NULL,NULL,NULL,'E17','E02','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578720000000000056',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','501','E22','8510000000020','8520000000005',NULL,NULL,NULL,NULL,'E17','E02','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578720000000000063',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','501','E22','8510000000006','8520000000012',NULL,NULL,NULL,NULL,'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,NULL
UNION SELECT '578720000000000070',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','501','E22','8510000000013','8520000000005',NULL,NULL,NULL,NULL,'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,NULL
UNION SELECT '578720000000000087',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','501','E22','8510000000013','8520000000005',NULL,NULL,NULL,NULL,'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,NULL
UNION SELECT '578720000000000094',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT15M','D01','501','E22','8510000000020','8520000000029',NULL,NULL,NULL,NULL,'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,NULL
UNION SELECT '578720000000000100',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','501','E22',NULL,NULL,'500','501',NULL,NULL,'E20',NULL,'KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578720000000000117',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT15M','D01','501','E22',NULL,NULL,'502','501',NULL,NULL,'E20',NULL,'KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578720000000000124',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT15M','D01','501','E22',NULL,NULL,'501','502',NULL,NULL,'E20',NULL,'KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578730000000000008',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','502','E22','8510000000006','8520000000005',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578730000000000015',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','502','E22','8510000000013','8520000000012',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578730000000000022',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','502','E22','8510000000020','8520000000005',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578730000000000039',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','502','E22','8510000000006','8520000000005',NULL,NULL,NULL,NULL,'E17','E02','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578730000000000046',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','502','E22','8510000000013','8520000000012',NULL,NULL,NULL,NULL,'E17','E02','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578730000000000053',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','502','E22','8510000000020','8520000000005',NULL,NULL,NULL,NULL,'E17','E02','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578730000000000060',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT15M','D01','502','E22','8510000000006','8520000000012',NULL,NULL,NULL,NULL,'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,NULL
UNION SELECT '578730000000000077',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','502','E22','8510000000013','8520000000005',NULL,NULL,NULL,NULL,'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,NULL
UNION SELECT '578730000000000084',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','502','E22','8510000000013','8520000000005',NULL,NULL,NULL,NULL,'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,NULL
UNION SELECT '578730000000000091',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT15M','D01','502','E22','8510000000020','8520000000029',NULL,NULL,NULL,NULL,'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,NULL
UNION SELECT '578730000000000107',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','502','E22',NULL,NULL,'500','502',NULL,NULL,'E20',NULL,'KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578730000000000114',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT15M','D01','502','E22',NULL,NULL,'501','502',NULL,NULL,'E20',NULL,'KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578730000000000121',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','502','E22',NULL,NULL,'502','501',NULL,NULL,'E20',NULL,'KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578730000000000138',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT15M','D01','502','E22',NULL,NULL,'502','500',NULL,NULL,'E20',NULL,'KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000158',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000037','8520000000012',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000165',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000037','8520000000012',NULL,NULL,NULL,NULL,'E18',NULL,'KWH','8716867000030','D11',NULL,NULL,NULL
UNION SELECT '578710000000000172',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000037','8520000000012',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000189',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000037','8520000000012',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000196',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000037','8520000000012',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL
UNION SELECT '578710000000000202',CONVERT(DATETIME, '2020-01-02T23:00:00.000Z', 127),NULL,'PT1H','D01','500','E22','8510000000037','8520000000012',NULL,NULL,NULL,NULL,'E17','D01','KWH','8716867000030',NULL,NULL,NULL,NULL

go

-- The minimum date and time for type 'datetime'
declare @min_date datetime;
select @min_date = -53690

go

CREATE OR ALTER VIEW [ODSMasterDataEnrichment] AS
select
	MarketEvaluationPoint_mRID,
	_ValidFrom as ValidFrom,
	_ValidTo as ValidTo,
	MeterReadingPeriodicity,
	MeteringMethod,
	MeteringGridArea_Domain_mRID,
	ConnectionState,
	EnergySupplier_MarketParticipant_mRID,
	BalanceResponsibleParty_MarketParticipant_mRID,
	InMeteringGridArea_Domain_mRID,
	OutMeteringGridArea_Domain_mRID,
	Parent_Domain_mRID,
	ServiceCategory_Kind,
	MarketEvaluationPointType,
	SettlementMethod,
	QuantityMeasurementUnit_Name,
	Product,
	Technology,
	OutMeteringGridArea_Domain_Owner_mRID,
	InMeteringGridArea_Domain_Owner_mRID,
	CONCAT(
		'[',
		CONCAT_WS(
			',',
			dl_energysupplier,
			dl_parent_energysupplier,
			dl_sts,
			dl_ez,
			dl_out_ddm,
			dl_in_ddm),
		']') as DistributionList,
	Meta
from (
	SELECT
		e.*,
		case when e.ValidFrom >= coalesce(parent.Validfrom, e.ValidFrom) then e.ValidFrom else parent.ValidFrom end as _ValidFrom,
		case when e.ValidTo > parent.ValidTo then parent.ValidTo else e.ValidTo end as _ValidTo,
		
		case
			when e.EnergySupplier_MarketParticipant_mRID is not null then '{"mRID":"'+e.EnergySupplier_MarketParticipant_mRID+'","role":"DDQ"}'
		end
		as dl_energysupplier,

		case
			when e.Parent_Domain_mRID is not null and e.MarketEvaluationPointType <> 'D20'
			then '{"mRID":"'+parent.EnergySupplier_MarketParticipant_mRID+'","role":"DDQ"}'
		end
		as dl_parent_energysupplier,

		case when (e.MarketEvaluationPointType) in ('E18', 'D01', 'D04') then '{"mRID":"5790001330584","role":"STS"}' end as dl_sts,

		case when e.MarketEvaluationPointType = 'D02' then '{"mRID":"5790000432752","role":"EZ"}' end as dl_ez,

		case when (e.MarketEvaluationPointType) in ('E20', 'D20') then '{"mRID":"'+e.OutMeteringGridArea_Domain_Owner_mRID+'","role":"DDM"}' end as dl_out_ddm,
		case when (e.MarketEvaluationPointType) in ('E20', 'D20') then '{"mRID":"'+e.InMeteringGridArea_Domain_Owner_mRID+'","role":"DDM"}' end as dl_in_ddm

	FROM dbo.ODSMasterDataEnrichment_manual as e
	-- Self join with parent and create new rows when parent valid period splits child valid period
	left outer join dbo.ODSMasterDataEnrichment_manual as parent
		on e.Parent_Domain_mRID = parent.MarketEvaluationPoint_mRID
		and (e.ValidFrom < parent.ValidTo or parent.ValidTo is null) and (parent.ValidFrom < e.ValidTo or e.ValidTo is null)
) foo
